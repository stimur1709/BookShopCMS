<ng-container>

  <div style="margin-bottom: 30px">
    <button *ngIf="!filter" (click)="showFilter()" mat-icon-button color="primary">
      <mat-icon>search</mat-icon>
    </button>

    <div class="mat-elevation-z8 col-md-6" *ngIf="filter">
      <button *ngIf="filter" (click)="showFilter()" mat-icon-button color="primary">
        <mat-icon>keyboard_arrow_up</mat-icon>
      </button>
      <mat-form-field>
        <mat-label>Filter</mat-label>
        <input matInput (input)="applyInput()" placeholder="Ex. ium" #inputElement>
        <button *ngIf="inputElement" matSuffix mat-icon-button color="primary" aria-label="Clear" (click)="clearInput()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Enter a date range</mat-label>
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
          <input matStartDate formControlName="start" placeholder="Start date">
          <input matEndDate formControlName="end" placeholder="End date">
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>

        <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')">Invalid start date</mat-error>
        <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')">Invalid end date</mat-error>
      </mat-form-field>

      <section class="example-section" (click)="applyFilter()">
        <mat-checkbox class="example-margin" color="primary" [(ngModel)]="queryParams.bestseller">bestseller
        </mat-checkbox>
        <mat-checkbox class="example-margin" color="primary" [(ngModel)]="queryParams.discount">discount
        </mat-checkbox>
      </section>
    </div>
  </div>

  <div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortChanged($event)">

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="title"> title</th>
        <td mat-cell *matCellDef="let element"> {{element.title}}
          <ng-container *ngIf="element.isBestseller == 1">
            <mat-icon style="vertical-align: middle" class="Card-price">star</mat-icon>
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="price"> price</th>
        <td mat-cell *matCellDef="let element" (click)="openModal()">
          <container-element [ngSwitch]="element.discount">
            <ng-container *ngSwitchCase="0">
              <span class="Card-price">{{element.price | number: '1.2-2'}}</span>
            </ng-container>
            <span *ngSwitchDefault style="display: grid">
              <span class="Card-priceOld">{{element.price | currency: '₽'}}</span>
                <span class="Card-price">
                  {{element.discount | percent: '1.0'}}
                  {{element.price - (element.discount * element.price) | currency: '₽'}}
                </span>
          </span>
          </container-element>
        </td>
      </ng-container>

      <ng-container matColumnDef="pubDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="pub_date"> pubDate</th>
        <td mat-cell *matCellDef="let element"> {{element.pubDate | date: 'dd.MM.yyyy'}} </td>
      </ng-container>

      <ng-container matColumnDef="popularity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="popularity"> popularity</th>
        <td mat-cell *matCellDef="let element"> {{element.popularity | number: '1.2-2'}} </td>
      </ng-container>

      <ng-container matColumnDef="rate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="rate"> rate</th>
        <td mat-cell *matCellDef="let element"> {{element.rate != null ? element.rate : 0 | number: '1.2-2'}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator showFirstLastButtons
                   (page)="pageChanged($event)"
                   aria-label="Select page"
                   [pageSizeOptions]="[10, 25, 50, 100]"
                   [pageIndex]="queryParams.offset"
                   [pageSize]="queryParams.limit"
                   [length]="paginatorParams.totalElements"
    ></mat-paginator>
  </div>
</ng-container>

