<ng-container>

  <app-filter class="fixed-filter" style="margin-bottom: 50px"
              [(queryParams)]="queryParams" [(filter)]="filter"
              [type]="2" (queryParamsChange)="getData()">
  </app-filter>

  <div class="mat-elevation-z8 table-container" style="{{filter ? 'max-height: 452px' : 'max-height: 523px'}}">
    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortChanged($event)">

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="title"> title</th>
        <td mat-cell *matCellDef="let element" (click)="openModal(element.slug, 1)" class="link-active">
          {{element.title}}
          <ng-container *ngIf="element.isBestseller == 1">
            <mat-icon style="vertical-align: middle" class="Card-price">star</mat-icon>
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="price"> price</th>
        <td mat-cell *matCellDef="let element">
          <container-element [ngSwitch]="element.discount">
            <ng-container *ngSwitchCase="0">
              <span class="Card-price">{{element.price | number: '1.2-2'}}</span>
            </ng-container>
            <span *ngSwitchDefault style="display: grid">
              <span class="Card-priceOld">{{element.price | currency: '₽'}}</span>
              <span class="Card-price">
                {{element.discount | percent: '1.0'}}
                {{element.price - (element.discount * element.price) | currency: '₽'}}
              </span>
          </span>
          </container-element>
        </td>
      </ng-container>

      <ng-container matColumnDef="pubDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="pub_date"> pubDate</th>
        <td mat-cell *matCellDef="let element"> {{element.pubDate | date: 'dd.MM.yyyy'}} </td>
      </ng-container>

      <ng-container matColumnDef="popularity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="popularity"> popularity</th>
        <td mat-cell *matCellDef="let element"> {{element.popularity | number: '1.2-2'}} </td>
      </ng-container>

      <ng-container matColumnDef="rate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="rate"> rate</th>
        <td mat-cell *matCellDef="let element"> {{element.rate != null ? element.rate : 0 | number: '1.2-2'}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="fixed-table"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="paginator-container">
      <mat-paginator showFirstLastButtons class="fixed-paginator"
                     (page)="pageChanged($event)"
                     aria-label="Select page"
                     [pageSizeOptions]="[10, 25, 50, 100]"
                     [pageIndex]="queryParams.offset"
                     [pageSize]="queryParams.limit"
                     [length]="paginatorParams.totalElements"
      ></mat-paginator>
    </div>
  </div>
</ng-container>

